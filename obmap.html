<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
	<title>UESP:Oblivion Map</title>
	<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
	<meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1">
	<link rel="stylesheet" href="gamemap.css?date=15May2018" />
	<link rel="stylesheet" href="obgamemap.css?date=15May2018" />
	<link rel="stylesheet" media="only screen and (max-device-width:799px)" href="gamemap-mobile.css?date=29march2014a"/>
		<!-- Google tag (gtag.js) -->
		<script async src="https://www.googletagmanager.com/gtag/js?id=UA-1386039-6"></script>
		<script>
		  window.dataLayer = window.dataLayer || [];
		  function gtag(){dataLayer.push(arguments);}
		  gtag('js', new Date());
		
		  gtag('config', 'UA-1386039-6');
		</script>
	<script type="text/javascript" src="jquery-1.10.2.js"></script>
	<script type="text/javascript" src="common.js?date=8May2018"></script>
	<script type="text/javascript" src="bounds.js?date=29march2014a"></script>
	<script type="text/javascript" src="mapoptions.js?date=29march2014a"></script>
	<script type="text/javascript" src="mapstate.js?date=29march2014a"></script>
	<script type="text/javascript" src="location.js?date=3Sept2018"></script>
	<script type="text/javascript" src="world.js?date=25sept2017"></script>
	<script type="text/javascript" src="maptile.js?date=29march2014a"></script>
	<script type="text/javascript" src="gamemap.js?date=8Sept2018"></script>
	<!--OFFLINE_JAVASCRIPT-->
	<script type="text/javascript">
		var obIconMap = {
				0: "None",
				1: "Camp",
				2: "Cave",
				3: "City",
				4: "Elven Ruin",
				5: "Fort Ruin",
				6: "Mine",
				7: "Landmark",
				9: "Settlement",
				10: "Daedric Shrine",
				11: "Oblivion Gate",
				20: "Ayleid Well",
				21: "Doom Stone",
				22: "Rune Stone",
				23: "Wayshrine",
				30: "Nirnroot",
				31: "Treasure",
				40: "Door",
				41: "House",
				42: "Shop",
				43: "Chapel",
				44: "Tavern",
				45: "Guild",
				46: "Castle",
				100: "Other",
		};
		
		var g_GameMap = null;
		var g_MapState = null;
		
		var g_DefaultMapOptions = {
				getMapTileFunction : getDefaultMapTile,
				wikiUrl: "//en.uesp.net/wiki/",
				wikiNamespace: "Oblivion",
				mapUrl : "//esomap.uesp.net/obmap.html",
				missingMapTile:  "//maps.uesp.net/images/oboutofrange.jpg",
				iconPath: "obicons/",
				iconTypeMap: obIconMap,
				gamePosX1: -262144,
				gamePosX2: 262144,
				gamePosY1: 245760,
				gamePosY2: -245760,
				initialGamePosX : 80000,
				initialGamePosY : -33500,
				initialZoom : 11,
				tileCountX : 11,
				tileCountY : 9,
				mapLinkElement : '#gmMapLink',
				homeWorldId : 1,
				minValidWorldId : 0,
				maxValidWorldId : 20000,
				dbPrefix: "ob",
				helpTemplate: "template/obhelpblock.txt",
				showSearchThisLocation: false,
				defaultIconWidth: 16,
				defaultIconHeight: 30,
				canvasBGColor: "#635F46",
				
				gridStartX: -262144,
				gridStartY: -262144,
				gridStopX: 262144,
				gridStopY: 245760,
				gridDeltaX: 4096,
				gridDeltaY: 4096,
				gridStyle: "rgba(255,255,0,0.5)",
				gridStartLabelZoom: 13,
				gridShowLabels: true,
				gridLabelOffsetX: 0,
				gridLabelOffsetY: -12288,
				gridOffsetPowerY: 2,
				gridOffsetY: 37,
				
				// TODO: Permissions?
				<!--OFFLINE_OPTIONS-->
		};
				
		
		function getDefaultMapTile(xPos, yPos, zoom, worldName, displayState)
		{
			return "//maps.uesp.net/obmap/zoom" + zoom + "/tamriel-" + xPos + "-" + yPos + "-" + zoom + ".jpg";
		}
				
				
		function getDefaultMapTile_Offline(xPos, yPos, zoom, worldName)
		{
				//TODO
			return "/zoom" + zoom + "/tamriel-" + xPos + "-" + yPos + "-" + zoom + ".jpg";
		}

		
		function onWorldLoad()
		{
			if (this.hasCenterOnParam()) return;
			
			defaultMapState = new uesp.gamemap.MapState();
			
			defaultMapState.worldId = 1;
			defaultMapState.zoomLevel = 11;
			defaultMapState.gamePos.x = 80000;
			defaultMapState.gamePos.y = -33500;
			defaultMapState.grid = false;
			
			mapState = this.getMapStateFromQuery(defaultMapState);
			this.setMapState(mapState);
		}
		
		
		if (g_DefaultMapOptions.isOffline)
		{
			g_DefaultMapOptions.getMapTileFunction = getDefaultMapTile_Offline;
			g_DefaultMapOptions.missingMapTile = "blacknulltile.jpg";
		}
		
		
		function onPermLoad()
		{
			canEdit = this.canEdit() && !uesp.isMobileDevice();
			
			if (canEdit)
			{
				$("#gmMapEditButtons").show();
				$("#addLocationButton").show();
				$("#addPathButton").show();
				$("#addAreaButton").show();
				$("#editWorldButton").show();
				$("#showRecentChangeButton").show();
			}
			else
			{
				$("#addLocationButton").hide();
				$("#addPathButton").hide();
				$("#addAreaButton").hide();
				$("#editWorldButton").hide();
				$("#showRecentChangeButton").hide();
			}
			
			updateMenuBarHeight();
		}
		
		
		$(window).resize( function(e) {
			updateMenuBarHeight();
		});
		
		
		function updateMenuBarHeight()
		{
			var menuBar = $("#gmMenuBar");
			var map = $('#gmMap');
			
			var height = menuBar.height();
			map.css('top', '' + height + 'px');
		}
		
		$( document ).ready( function()
		{
			userEvents = {
				onMapWorldsLoaded   : onWorldLoad,
				onPermissionsLoaded : onPermLoad,
			};
			
			g_GameMap = new uesp.gamemap.Map('gmMap', g_DefaultMapOptions, userEvents);
			
			$("#gmMapCellGrid").bind("touchstart click", { self: g_GameMap }, g_GameMap.onCellGridClick);
			
			updateMenuBarHeight();
		});
		
		
	</script>
</head>
<body>

<div id="gmMenuBar">
		<div id="gmTitle">UESP:Oblivion Map</div>
		
		<ol class="gmMenuLinks">
			<li class="gmMenuItem gmNoMobile"><a title="The permanent and complete link for the current map view" href="" id="gmMapLink">Link</a></li>
			<li class="gmMenuItem gmNoMobile"><a title="Reset the map state" href="" id="gmMapReset">Reset</a></li>
			<!-- 
			<li class="gmMenuItem gmNoMobile"><div title="Show the cell grid line boundaries and coordinates" id="gmMapCellGrid">Show Cell Grid</div></li>
			 -->
		</ol>
		<div id="gmMapListRoot" tabindex="0" style="display:none;">
			<!--OFFLINE_GROUPLIST-->
		</div>
		
		<div id="gmMenuLinksRight">
			<ol class="gmMenuLinks">
				<li class="gmMenuItem gmNoMobile" onclick="g_GameMap.showMapKey();" ontouchstart="g_GameMap.showMapKey();" id="gmMapShowKey">Map Key</li>
				<li class="gmMenuItem gmNoMobile" onclick="g_GameMap.showHelpBlock();" ontouchstart="g_GameMap.showHelpBlock();" id="gmHelp">Help</li>
				<li class="gmMenuItem gmNoMobile"><a href="//www.uesp.net/wiki/UESPWiki_talk:Oblivion_Map_Design" id="gmMapDiscuss">Discuss</a></li>
				<li class="gmMenuItem gmNoMobile"><a href="//www.uesp.net/wiki/Main_Page" id="gmMapHome">UESP Home</a></li>
			</ol>
		</div>
		
		<div id="gmMapEditButtons" style="display:none;">
			<button id="editWorldButton" class="gmNoMobile" style="display:none;" onclick="g_GameMap.onEditWorld();" ontouchstart="g_GameMap.onEditWorld();">Edit World</button>
			<button id="addLocationButton" class="gmNoMobile" style="display:none;" onclick="g_GameMap.onAddLocationStart();"  ontouchstart="g_GameMap.onAddLocationStart();">Add Location</button>
			<button id="addPathButton" class="gmNoMobile" style="display:none;" onclick="g_GameMap.onAddPathStart();"  ontouchstart="g_GameMap.onAddPathStart();">Add Path</button>
			<button id="addAreaButton" class="gmNoMobile" style="display:none;" onclick="g_GameMap.onAddAreaStart();"  ontouchstart="g_GameMap.onAddAreaStart();">Add Area</button>
			&nbsp;
			<div id="showRecentChangeButton" class="gmToggleButton gmNoMobile" style="display:none;" onclick="g_GameMap.onRecentChanges(this);" ontouchstart="g_GameMap.onRecentChanges(this);">Recent Changes</div>
		</div>
</div>

<div id="gmMap">
	<!--OFFLINE_HELPBLOCK-->
</div>

</body>
</html>
