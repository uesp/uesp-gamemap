<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
	<title>UESP:Elder Scrolls Online Map</title>
	<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
	<link rel="stylesheet" href="gamemap.css?date=29march2014" />
	<script type="text/javascript" src="jquery-1.10.2.js"></script>
	<script type="text/javascript" src="common.js?date=29march2014"></script>
	<script type="text/javascript" src="bounds.js?date=29march2014"></script>
	<script type="text/javascript" src="mapoptions.js?date=29march2014"></script>
	<script type="text/javascript" src="mapstate.js?date=29march2014"></script>
	<script type="text/javascript" src="location.js?date=29march2014"></script>
	<script type="text/javascript" src="world.js?date=29march2014"></script>
	<script type="text/javascript" src="maptile.js?date=29march2014"></script>
	<script type="text/javascript" src="gamemap.js?date=29march2014"></script>
	<script type="text/javascript">
		var esoIconMap = {
				1  : "Artifact Gate",
				2  : "Bank",
				3  : "Battle",
				4  : "Border Keep",
				5  : "Caravan",
				6  : "Clothier",
				7  : "Dock",
				8  : "Elder Scroll",
				9  : "Farm",
				10 : "Forward Camp",
				11 : "Inn",
				12 : "Keep",
				13 : "Lumber Mill",
				14 : "Mine",
				15 : "Outpost",
				16 : "Smithy",
				17 : "Temple",
				18 : "Vendor",
				19 : "Wayshrine",
				20 : "Arcanist",
				21 : "Woodworker",
				22 : "Alchemist",
				23 : "Brewer",
				24 : "Armory",
				25 : "Pack Merchant",
				26 : "Banker",
				27 : "Outfitter",
				28 : "Cooking Fire",
				29 : "Enchanter",
				30 : "Fighters Guild",
				31 : "Hall Steward",
				32 : "Armorer",
				33 : "Tailor",
				34 : "Merchant",
				35 : "Mages Guild",
				36 : "Fishing Hole",
				37 : "Leatherworker",
				38 : "Perquisitor",
				39 : "Provisioner",
				40 : "Rededication Shrine",
				41 : "Stable Master",
				42 : "Weaponsmith",
				43 : "Travel NPC",
				44 : "Blacksmith",
				50 : "Area of Interest",
				51 : "Aylied Ruin",
				52 : "Camp",
				53 : "Cave",
				54 : "Cemetary",
				55 : "City",
				56 : "Crafting Site",
				57 : "Crypt", 
				58 : "Daedric Ruin",
				59 : "Dungeon",
				60 : "Dwemer Ruin",
				61 : "Estate",
				62 : "Quest Start",
				63 : "Group Boss",
				64 : "Group Dungeon",
				65 : "Group Instance",
				66 : "Grove",
				67 : "Lighthouse",
				68 : "Mundus Stone",
				69 : "Oblivion Portal",
				70 : "Public Dungeon",
				71 : "Ruin",
				72 : "Sewer",
				73 : "Tower",
				74 : "Town",
				75 : "Skyshard",
				76 : "Lore Book",
				77 : "Quest",
				78 : "Quest Door",
				79 : "Treasure Map",
				80 : "House",
				81 : "NPC",
				82 : "Named NPC",
				83 : "Chest",
				84 : "Alchemy Station",
				85 : "Enchanting Table",
				86 : "Blacksmith Station",
				87 : "Woodworking Station",
				88 : "Clothing Station",
				89 : "Heavy Sack",
				90 : "Crafting Node",
				91 : "Container",
				92 : "Artifact Gate (AD)",
				93 : "Artifact Gate (DA)",
				94 : "Artifact Gate (EP)",
				95 : "Artifact Temple (AD)",
				96 : "Artifact Temple (DA)",
				97 : "Artifact Temple (EP)",
				98 : "Border Keep (AD)",
				99 : "Border Keep (DA)",
				100: "Border Keep (EP)",
				101: "Cemetary (AD)",
				102: "Cemetary (DA)",
				103: "Cemetary (EP)",
				104: "Farm (AD)",
				105: "Farm (DA)",
				106: "Farm (EP)",
				107: "Keep (AD)",
				108: "Keep (DA)",
				109: "Keep (EP)",
				110: "Lumber Mill (AD)",
				111: "Lumber Mill (DA)",
				112: "Lumber Mill (EP)",
				113: "Mine (AD)",
				114: "Mine (DA)",
				115: "Mine (EP)",
				116: "Outpost (AD)",
				117: "Outpost (DA)",
				118: "Outpost (EP)",
				119: "Carpenter",
				120: "Armsman",
				121: "Chef",
				122: "Grocer",
				123: "Mystic",
				124: "Magus",
				125: "Innkeeper",
				126: "Boatswain"
		};
		
		var g_GameMap = null;
		var g_MapState = null;
		
		var g_DefaultMapOptions = {
				getMapTileFunction : getDefaultMapTile,
				wikiUrl: "http://www.uesp.net/wiki/",
				mapUrl : "http://esomap.uesp.net/esomap.html",
				missingMapTile:  "http://maps.uesp.net/esomap/blacknulltile.jpg",
				iconPath: "icons/",
				wikiNamespace: "ESO",
				iconTypeMap: esoIconMap,
				gamePosX1: 0,
				gamePosX2: 1000000,
				gamePosY1: 1000000,
				gamePosY2: 0,
				initialGamePosX : 400000,
				initialGamePosY : 600000,
				initialZoom : 10,
		};
		
		
		function onWorldLoad()
		{
			defaultMapState = new uesp.gamemap.MapState();
			
			defaultMapState.worldId = 668;
			defaultMapState.zoomLevel = 9;
			defaultMapState.gamePos.x = 500000;
			defaultMapState.gamePos.y = 500000;
			
			mapState = this.getMapStateFromQuery(defaultMapState);
			this.setMapState(mapState);
		}
		
		
		function onPermLoad()
		{
			canEdit = this.canEdit();
			
			if (canEdit)
			{
				$("#addLocationButton").show();
				$("#addPathButton").show();
				$("#addAreaButton").show();
				$("#editWorldButton").show();
			}
			else
			{
				$("#addLocationButton").hide();
				$("#addPathButton").hide();
				$("#addAreaButton").hide();
				$("#editWorldButton").hide();
			}
		}
		
		
		$( document ).ready( function()
		{
			userEvents = {
				onMapWorldsLoaded   : onWorldLoad,
				onPermissionsLoaded : onPermLoad,
				onMapWorldChanged   : onWorldChanged
			};
			
			g_GameMap = new uesp.gamemap.Map('gmMap', g_DefaultMapOptions, userEvents);
			
				// TODO: Change how map list is created
			g_GameMap.createMapList($("#gmMapListRoot"));
			
				// TODO: Temporary call to get the group-world list for ESO
			$.get( 'template/worldgrouplist.txt', function( data ) {
				g_GameMap.worldGroupListContents = data;
				uesp.logDebug(uesp.LOG_LEVEL_ERROR, 'Received world group list contents!');
				$('#gmMapList').html(data);
				g_GameMap.setEventsForMapGroupList();
			});
			
			
		});
		
		
		function getDefaultMapTile(xPos, yPos, zoom, worldName)
		{
			return "http://maps.uesp.net/esomap/" + worldName + "/zoom" + zoom + "/" + worldName + "-" + xPos + "-" + yPos + ".jpg";
		}
		
		
			// TODO: Move into Map class
		function onWorldChanged(newWorld)
		{
			foundListItems = $('#gmMapList li:contains("' + newWorld.displayName +'")').not('.gmMapListHeader');
			
			var foundListItem = null;
			var minTextLength = 1000;
			
			foundListItems.each(function( index ) {
				textLen = $(this).text().length;
				
				if (textLen < minTextLength)
				{
					minTextLength = textLen;
					foundListItem = $(this);
				}
			});
			
			if (foundListItem != null)
			{
				if (g_GameMap.mapListLastSelectedItem != null) g_GameMap.mapListLastSelectedItem.removeClass('gmMapListSelect');
				foundListItem.addClass('gmMapListSelect');
				g_GameMap.mapListLastSelectedItem = foundListItem;
				$(foundListItem).parents('ul:first').show();
			}
			
			$('#gmMapListAlphaSelect').val(newWorld.id);
			
			$('#gmMapNameLabel').text("Map: " + newWorld.displayName);
		}
		
		
	</script>
</head>
<body>

<div id="gmMenuBar">
		<div id="gmTitle">UESP:Elder Scrolls Online Map</div>
		
		<ol class="gmMenuLinks">
			<li class="gmMenuItem"><a href="" id="gmMapLink">Link to Current Map</a></li>
			<li class="gmMenuItem"><a href="" id="gmMapReset">Reset Map</a></li>
			<li class="gmMenuItem" id="gmMapNameLabel" onclick="g_GameMap.showMapList();">Map:</li>
		</ol>
		<div id="gmMapListRoot" tabindex="0" style="display:none;"></div>
		
		<button id="editWorldButton" style="display:none;" onclick="g_GameMap.onEditWorld();">Edit World</button>
		<button id="addLocationButton" style="display:none;" onclick="g_GameMap.onAddLocationStart();">Add Location</button>
		<button id="addPathButton" style="display:none;" onclick="g_GameMap.onAddPathStart();">Add Path</button>
		<button id="addAreaButton" style="display:none;" onclick="g_GameMap.onAddAreaStart();">Add Area</button>
		
		<div id="gmMenuLinksRight">
			<ol class="gmMenuLinks">
				<li class="gmMenuItem" onclick="g_GameMap.showMapKey();">Map Key</li>
				<li class="gmMenuItem"><a href="http://www.uesp.net/wiki/UESPWiki:ESO_Map_Design" target="_new">Help</a></li>
				<li class="gmMenuItem"><a href="http://www.uesp.net/wiki/UESPWiki_talk:ESO_Map_Design">Discuss</a></li>
				<li class="gmMenuItem"><a href="http://www.uesp.net/wiki/Main_Page">UESP Home</a></li>
			</ol>
		</div>
</div>

<div id="gmMap">
</div>

<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-1386039-6']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

</body>
</html>
